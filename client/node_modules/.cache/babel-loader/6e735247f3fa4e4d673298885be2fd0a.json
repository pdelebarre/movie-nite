{"ast":null,"code":"import _regeneratorRuntime from\"/Volumes/LaCie/Dev/myProjects/movie-nite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Volumes/LaCie/Dev/myProjects/movie-nite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Volumes/LaCie/Dev/myProjects/movie-nite/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useMongoDB}from\"./store/mongodb\";import{useRealmApp}from\"./store/realm\";import SearchMovie from\"./components/Movie/SearchMovie\";import MovieList from\"./components/Movie/MovieList\";// import TestMongo from \"./tests/TestMongo\";\nimport GENRES from\"./resources/genres\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var getGenres=function getGenres(genre_ids){var genres_array=[];genre_ids.map(function(id){var result=GENRES.find(function(genre){return genre.id===id;});genres_array.push(result.name);return genres_array;});console.log(genres_array.toString());return genres_array.toString();};function App(){// const API_KEY =\n//   \"X6vbOvQjCACWfxM0IMCGmS8u1j5mPLqL5YnoQFu99dPqn5UnSzGXOeFJ0mp7ZzbB\";\nvar _useRealmApp=useRealmApp(),loginApiKey=_useRealmApp.loginApiKey,logOut=_useRealmApp.logOut,user=_useRealmApp.user;var _useMongoDB=useMongoDB(),db=_useMongoDB.db;handleLogIn();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),movies=_useState2[0],setMovies=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),refresh=_useState4[0],setRefresh=_useState4[1];var addMovie=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(movie){var genres;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"adding \",movie);genres=getGenres(movie.genre_ids);_context.next=4;return db.collection(\"movies\").insertOne({id:movie.id,title:movie.title,genres:genres,poster_path:movie.poster_path,overview:movie.overview,vote_average:Number(movie.vote_average),watched:false}).then(function(result){return console.log(\"Successfully inserted item with _id: \".concat(result.insertedId));}).catch(function(err){return console.error(\"Failed to insert item: \".concat(err));});case 4:case\"end\":return _context.stop();}}},_callee);}));return function addMovie(_x){return _ref.apply(this,arguments);};}();useEffect(function(){function wrapMovieQuery(){return _wrapMovieQuery.apply(this,arguments);}function _wrapMovieQuery(){_wrapMovieQuery=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var authoredMovies;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(user&&db)){_context2.next=5;break;}_context2.next=3;return db.collection(\"movies\").find({},{sort:{\"watched\":1}});case 3:authoredMovies=_context2.sent;setMovies(authoredMovies);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _wrapMovieQuery.apply(this,arguments);}wrapMovieQuery();},[user,db,refresh]);function handleLogIn(){return _handleLogIn.apply(this,arguments);}function _handleLogIn(){_handleLogIn=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return loginApiKey();case 2:case\"end\":return _context7.stop();}}},_callee7);}));return _handleLogIn.apply(this,arguments);}var isDuplicate=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(movie){var dupe;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return db.collection(\"movies\").findOne({id:movie.id});case 2:dupe=_context3.sent;console.log(\"dupe?\",dupe);return _context3.abrupt(\"return\",!(dupe===null));case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function isDuplicate(_x2){return _ref2.apply(this,arguments);};}();var onAddHandler=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(movie){var dupe;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"in App, adding: \",movie);_context4.next=3;return isDuplicate(movie);case 3:dupe=_context4.sent;dupe?console.log(\"dupe\",movie):addMovie(movie);setRefresh(function(st){return!st;});case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function onAddHandler(_x3){return _ref3.apply(this,arguments);};}();var onWatchedHandler=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(movie){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return db.collection(\"movies\").updateOne({id:movie.id},{$set:{watched:!movie.watched}}).then(function(result){return console.log(\"Successfully flagged item with _id: \".concat(result.insertedId));}).catch(function(err){return console.error(\"Failed to flag item: \".concat(err));});case 2:case\"end\":return _context5.stop();}}},_callee5);}));return function onWatchedHandler(_x4){return _ref4.apply(this,arguments);};}();var onRemoveHandler=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(movie){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return db.collection(\"movies\").deleteOne({id:movie.id}).then(function(result){return console.log(\"Successfully deleted item with _id: \".concat(result.insertedId));}).catch(function(err){return console.error(\"Failed to delete item: \".concat(err));});case 2:case\"end\":return _context6.stop();}}},_callee6);}));return function onRemoveHandler(_x5){return _ref5.apply(this,arguments);};}();return user&&db&&user.state===\"active\"&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(MovieList,{movies:movies,user:user,logOut:logOut,onWatchedHandler:onWatchedHandler,onRemoveHandler:onRemoveHandler}),/*#__PURE__*/_jsx(SearchMovie,{onAddHandler:onAddHandler})]});}export default App;","map":{"version":3,"sources":["/Volumes/LaCie/Dev/myProjects/movie-nite/src/App.js"],"names":["React","useState","useEffect","useMongoDB","useRealmApp","SearchMovie","MovieList","GENRES","getGenres","genre_ids","genres_array","map","id","result","find","genre","push","name","console","log","toString","App","loginApiKey","logOut","user","db","handleLogIn","movies","setMovies","refresh","setRefresh","addMovie","movie","genres","collection","insertOne","title","poster_path","overview","vote_average","Number","watched","then","insertedId","catch","err","error","wrapMovieQuery","sort","authoredMovies","isDuplicate","findOne","dupe","onAddHandler","st","onWatchedHandler","updateOne","$set","onRemoveHandler","deleteOne","state"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useMongoDB } from \"./store/mongodb\";\nimport { useRealmApp } from \"./store/realm\";\n\nimport SearchMovie from \"./components/Movie/SearchMovie\";\nimport MovieList from \"./components/Movie/MovieList\";\n\n// import TestMongo from \"./tests/TestMongo\";\n\nimport GENRES from \"./resources/genres\";\n\nconst getGenres = (genre_ids) => {\n  let genres_array = [];\n  genre_ids.map((id) => {\n    const result = GENRES.find((genre) => genre.id === id);\n    genres_array.push(result.name);\n    return genres_array;\n  });\n\n  console.log(genres_array.toString());\n  return genres_array.toString();\n};\n\nfunction App() {\n  // const API_KEY =\n  //   \"X6vbOvQjCACWfxM0IMCGmS8u1j5mPLqL5YnoQFu99dPqn5UnSzGXOeFJ0mp7ZzbB\";\n\n  const { loginApiKey, logOut, user } = useRealmApp();\n  const { db } = useMongoDB();\n\n  handleLogIn();\n\n  const [movies, setMovies] = useState([]);\n\n  const [refresh, setRefresh] = useState(false);\n\n  const addMovie = async (movie) => {\n    console.log(`adding `, movie);\n\n    const genres = getGenres(movie.genre_ids);\n    await db\n      .collection(\"movies\")\n      .insertOne({\n        id: movie.id,\n        title: movie.title,\n        genres: genres,\n        poster_path: movie.poster_path,\n        overview: movie.overview,\n        vote_average: Number(movie.vote_average),\n        watched: false,\n      })\n      .then((result) =>\n        console.log(`Successfully inserted item with _id: ${result.insertedId}`)\n      )\n      .catch((err) => console.error(`Failed to insert item: ${err}`));\n  };\n\n  useEffect(() => {\n    async function wrapMovieQuery() {\n      if (user && db) {\n        const authoredMovies = await db.collection(\"movies\").find({},{sort:{ \"watched\": 1 }});\n        setMovies(authoredMovies);\n      }\n    }\n    wrapMovieQuery();\n  }, [user, db, refresh]);\n\n  async function handleLogIn() {\n\n    await loginApiKey();\n  }\n\n  const isDuplicate = async (movie) => {\n    const dupe = await db.collection(\"movies\").findOne({ id: movie.id });\n    console.log(\"dupe?\", dupe);\n\n    return !(dupe === null);\n  };\n\n  const onAddHandler = async (movie) => {\n    console.log(`in App, adding: `, movie);\n    let dupe = await isDuplicate(movie);\n    dupe ? console.log(`dupe`, movie) : addMovie(movie);\n    setRefresh((st) => !st);\n  };\n\n  const onWatchedHandler = async (movie) => {\n    await db\n      .collection(\"movies\")\n      .updateOne({ id: movie.id }, { $set: { watched: !movie.watched } })\n      .then((result) =>\n        console.log(`Successfully flagged item with _id: ${result.insertedId}`)\n      )\n      .catch((err) => console.error(`Failed to flag item: ${err}`));\n\n  };\n\n  const onRemoveHandler = async (movie) => {\n    await db\n      .collection(\"movies\")\n      .deleteOne({ id: movie.id })\n      .then((result) =>\n        console.log(`Successfully deleted item with _id: ${result.insertedId}`)\n      )\n      .catch((err) => console.error(`Failed to delete item: ${err}`));\n  };\n\n  return user && db && user.state === \"active\" && (\n    <div>\n      <MovieList\n        movies={movies}\n        user={user}\n        logOut={logOut}\n        onWatchedHandler={onWatchedHandler}\n        onRemoveHandler={onRemoveHandler}\n      />\n      <SearchMovie onAddHandler={onAddHandler} />\n\n      {/* <TestMongo /> */}\n    </div>\n  ) \n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}