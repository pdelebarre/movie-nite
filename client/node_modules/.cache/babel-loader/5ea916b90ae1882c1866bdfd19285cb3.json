{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React, { memo, useRef, useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { Textarea } from '../../textarea';\nvar EditableCellField = /*#__PURE__*/memo(function EditableCellField(props) {\n  var getTargetRef = props.getTargetRef;\n\n  var getTableBodyRef = function getTableBodyRef() {\n    var ref = getTargetRef();\n    if (!ref) return;\n\n    while (ref) {\n      var isTableBody = ref.hasAttribute('data-evergreen-table-body');\n\n      if (isTableBody) {\n        return ref;\n      }\n\n      if (ref.parentElement) {\n        ref = ref.parentElement;\n      } else {\n        return null;\n      }\n    }\n\n    return ref;\n  };\n\n  var latestAnimationFrame = useRef();\n  var textareaRef = useRef();\n  var tableBodyRef = useRef();\n\n  var _useState = useState({\n    top: 0,\n    left: 0,\n    height: 0,\n    width: 0\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      _useState2$ = _useState2[0],\n      height = _useState2$.height,\n      left = _useState2$.left,\n      top = _useState2$.top,\n      width = _useState2$.width,\n      setDimensions = _useState2[1]; // Mirrors functionality of componentDidMount and componentWillUnmount.\n  // Focus on mount\n\n\n  useEffect(function () {\n    update();\n    var requestId = requestAnimationFrame(function () {\n      if (textareaRef.current) {\n        textareaRef.current.focus();\n      }\n    });\n    return function () {\n      cancelAnimationFrame(requestId);\n\n      if (latestAnimationFrame.current) {\n        cancelAnimationFrame(latestAnimationFrame.current);\n      }\n\n      props.onCancel();\n    };\n  }, []);\n\n  var update = function update() {\n    var getTargetRef = props.getTargetRef;\n    var targetRef = getTargetRef();\n    if (!targetRef) return;\n    tableBodyRef.current = getTableBodyRef();\n\n    var _targetRef$getBoundin = targetRef.getBoundingClientRect(),\n        targetHeight = _targetRef$getBoundin.height,\n        targetLeft = _targetRef$getBoundin.left,\n        targetTop = _targetRef$getBoundin.top,\n        targetWidth = _targetRef$getBoundin.width;\n\n    var calculatedTop;\n\n    if (tableBodyRef.current) {\n      var bounds = tableBodyRef.current.getBoundingClientRect();\n      calculatedTop = Math.min(Math.max(targetTop, bounds.top), bounds.bottom - targetHeight);\n    } else {\n      calculatedTop = targetTop;\n    }\n\n    setDimensions({\n      top: calculatedTop,\n      left: targetLeft,\n      height: targetHeight,\n      width: targetWidth\n    });\n    latestAnimationFrame.current = requestAnimationFrame(function () {\n      return update();\n    });\n  };\n\n  var handleFocus = function handleFocus(e) {\n    e.target.selectionStart = e.target.value.length;\n  };\n\n  var handleBlur = function handleBlur() {\n    if (textareaRef.current) props.onChangeComplete(textareaRef.current.value);\n  };\n\n  var handleKeyDown = function handleKeyDown(e) {\n    switch (e.key) {\n      case 'Escape':\n        props.onCancel();\n        if (textareaRef.current) textareaRef.current.blur();\n        break;\n\n      case 'Enter':\n        if (textareaRef.current) textareaRef.current.blur();\n        e.preventDefault();\n        break;\n\n      case 'Tab':\n        if (textareaRef.current) textareaRef.current.blur();\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  var _props$minHeight = props.minHeight,\n      minHeight = _props$minHeight === void 0 ? 40 : _props$minHeight,\n      _props$minWidth = props.minWidth,\n      minWidth = _props$minWidth === void 0 ? 80 : _props$minWidth,\n      size = props.size,\n      value = props.value,\n      zIndex = props.zIndex;\n  return /*#__PURE__*/React.createElement(Textarea, {\n    ref: textareaRef,\n    onKeyDown: handleKeyDown,\n    onBlur: handleBlur,\n    onFocus: handleFocus,\n    appearance: \"editable-cell\",\n    size: size,\n    style: {\n      left: left,\n      top: top,\n      height: height,\n      minHeight: Math.max(height, minHeight),\n      width: width,\n      minWidth: Math.max(width, minWidth),\n      zIndex: zIndex\n    },\n    height: null,\n    width: null,\n    minHeight: null,\n    position: \"fixed\",\n    defaultValue: value\n  });\n});\nEditableCellField.propTypes = {\n  /**\n   * Used as the defaultValue of the textarea.\n   */\n  value: PropTypes.string.isRequired,\n\n  /**\n   * The z-index placed on the element.\n   */\n  zIndex: PropTypes.number.isRequired,\n\n  /**\n   * Function to get the target ref of the parent.\n   * Used to mirror the position.\n   */\n  getTargetRef: PropTypes.func.isRequired,\n\n  /**\n   * Min width of the textarea.\n   * The textarea can never be smaller than the cell.\n   */\n  minWidth: PropTypes.number,\n\n  /**\n   * Min height of the textarea.\n   * The textarea can never be smaller than the cell.\n   */\n  minHeight: PropTypes.number,\n\n  /**\n   * Called when the textarea is blurred, pass the value back to the cell.\n   */\n  onChangeComplete: PropTypes.func.isRequired,\n\n  /**\n   * Called when Escape is hit or componentWillUnmount.\n   */\n  onCancel: PropTypes.func.isRequired,\n\n  /**\n   * Text size of the textarea.\n   */\n  size: PropTypes.number\n};\nexport default EditableCellField;","map":{"version":3,"sources":["../../../src/table/src/EditableCellField.js"],"names":["EditableCellField","memo","getTargetRef","props","getTableBodyRef","ref","isTableBody","latestAnimationFrame","useRef","textareaRef","tableBodyRef","height","left","top","width","setDimensions","useState","useEffect","update","requestId","requestAnimationFrame","cancelAnimationFrame","targetRef","targetHeight","targetLeft","targetTop","targetWidth","bounds","calculatedTop","Math","handleFocus","e","handleBlur","handleKeyDown","minHeight","minWidth","size","value","zIndex","PropTypes","onChangeComplete","onCancel","number"],"mappings":"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","sourcesContent":["import React, { memo, useRef, useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Textarea } from '../../textarea'\n\nconst EditableCellField = memo(function EditableCellField(props) {\n  const { getTargetRef } = props\n\n  const getTableBodyRef = () => {\n    let ref = getTargetRef()\n\n    if (!ref) return\n\n    while (ref) {\n      const isTableBody = ref.hasAttribute('data-evergreen-table-body')\n      if (isTableBody) {\n        return ref\n      }\n\n      if (ref.parentElement) {\n        ref = ref.parentElement\n      } else {\n        return null\n      }\n    }\n\n    return ref\n  }\n\n  const latestAnimationFrame = useRef()\n  const textareaRef = useRef()\n  const tableBodyRef = useRef()\n  const [{ height, left, top, width }, setDimensions] = useState({\n    top: 0,\n    left: 0,\n    height: 0,\n    width: 0\n  })\n\n  // Mirrors functionality of componentDidMount and componentWillUnmount.\n  // Focus on mount\n  useEffect(() => {\n    update()\n\n    const requestId = requestAnimationFrame(() => {\n      if (textareaRef.current) {\n        textareaRef.current.focus()\n      }\n    })\n\n    return () => {\n      cancelAnimationFrame(requestId)\n\n      if (latestAnimationFrame.current) {\n        cancelAnimationFrame(latestAnimationFrame.current)\n      }\n\n      props.onCancel()\n    }\n  }, [])\n\n  const update = () => {\n    const { getTargetRef } = props\n    const targetRef = getTargetRef()\n    if (!targetRef) return\n    tableBodyRef.current = getTableBodyRef()\n\n    const {\n      height: targetHeight,\n      left: targetLeft,\n      top: targetTop,\n      width: targetWidth\n    } = targetRef.getBoundingClientRect()\n\n    let calculatedTop\n    if (tableBodyRef.current) {\n      const bounds = tableBodyRef.current.getBoundingClientRect()\n      calculatedTop = Math.min(Math.max(targetTop, bounds.top), bounds.bottom - targetHeight)\n    } else {\n      calculatedTop = targetTop\n    }\n\n    setDimensions({\n      top: calculatedTop,\n      left: targetLeft,\n      height: targetHeight,\n      width: targetWidth\n    })\n    latestAnimationFrame.current = requestAnimationFrame(() => update())\n  }\n\n  const handleFocus = e => {\n    e.target.selectionStart = e.target.value.length\n  }\n\n  const handleBlur = () => {\n    if (textareaRef.current) props.onChangeComplete(textareaRef.current.value)\n  }\n\n  const handleKeyDown = e => {\n    switch (e.key) {\n      case 'Escape':\n        props.onCancel()\n        if (textareaRef.current) textareaRef.current.blur()\n        break\n      case 'Enter':\n        if (textareaRef.current) textareaRef.current.blur()\n        e.preventDefault()\n        break\n      case 'Tab':\n        if (textareaRef.current) textareaRef.current.blur()\n        break\n      default:\n        break\n    }\n  }\n\n  const { minHeight = 40, minWidth = 80, size, value, zIndex } = props\n\n  return (\n    <Textarea\n      ref={textareaRef}\n      onKeyDown={handleKeyDown}\n      onBlur={handleBlur}\n      onFocus={handleFocus}\n      appearance=\"editable-cell\"\n      size={size}\n      style={{\n        left,\n        top,\n        height,\n        minHeight: Math.max(height, minHeight),\n        width,\n        minWidth: Math.max(width, minWidth),\n        zIndex\n      }}\n      height={null}\n      width={null}\n      minHeight={null}\n      position=\"fixed\"\n      defaultValue={value}\n    />\n  )\n})\n\nEditableCellField.propTypes = {\n  /**\n   * Used as the defaultValue of the textarea.\n   */\n  value: PropTypes.string.isRequired,\n\n  /**\n   * The z-index placed on the element.\n   */\n  zIndex: PropTypes.number.isRequired,\n\n  /**\n   * Function to get the target ref of the parent.\n   * Used to mirror the position.\n   */\n  getTargetRef: PropTypes.func.isRequired,\n\n  /**\n   * Min width of the textarea.\n   * The textarea can never be smaller than the cell.\n   */\n  minWidth: PropTypes.number,\n\n  /**\n   * Min height of the textarea.\n   * The textarea can never be smaller than the cell.\n   */\n  minHeight: PropTypes.number,\n\n  /**\n   * Called when the textarea is blurred, pass the value back to the cell.\n   */\n  onChangeComplete: PropTypes.func.isRequired,\n\n  /**\n   * Called when Escape is hit or componentWillUnmount.\n   */\n  onCancel: PropTypes.func.isRequired,\n\n  /**\n   * Text size of the textarea.\n   */\n  size: PropTypes.number\n}\n\nexport default EditableCellField\n"]},"metadata":{},"sourceType":"module"}