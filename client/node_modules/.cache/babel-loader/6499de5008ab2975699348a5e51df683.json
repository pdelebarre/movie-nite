{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nimport React, { memo, forwardRef, useState, useEffect, useCallback } from 'react';\nimport Downshift from 'downshift';\nimport fuzzaldrin from 'fuzzaldrin-plus';\nimport PropTypes from 'prop-types';\nimport VirtualList from 'react-tiny-virtual-list';\nimport { Position } from '../../constants';\nimport { Pane } from '../../layers';\nimport { Popover } from '../../popover';\nimport { Text } from '../../typography';\nimport AutocompleteItem from './AutocompleteItem';\n\nvar fuzzyFilter = function fuzzyFilter(itemToString) {\n  if (itemToString) {\n    return function (items, input) {\n      var wrappedItems = items.map(function (item) {\n        return {\n          key: itemToString(item),\n          item: item\n        };\n      });\n      return fuzzaldrin.filter(wrappedItems, input, {\n        key: 'key'\n      }).map(function (_ref) {\n        var item = _ref.item;\n        return item;\n      });\n    };\n  }\n\n  return function (items, input) {\n    return fuzzaldrin.filter(items, input);\n  };\n};\n\nvar noop = function noop() {};\n\nvar autocompleteItemRenderer = function autocompleteItemRenderer(props) {\n  return /*#__PURE__*/React.createElement(AutocompleteItem, props);\n};\n\nautocompleteItemRenderer.displayName = \"autocompleteItemRenderer\";\n/* eslint-disable react/prop-types */\n\nvar AutocompleteItems = function AutocompleteItems(_ref2) {\n  var getItemProps = _ref2.getItemProps,\n      getMenuProps = _ref2.getMenuProps,\n      highlightedIndex = _ref2.highlightedIndex,\n      inputValue = _ref2.inputValue,\n      isFilterDisabled = _ref2.isFilterDisabled,\n      itemSize = _ref2.itemSize,\n      itemToString = _ref2.itemToString,\n      itemsFilter = _ref2.itemsFilter,\n      originalItems = _ref2.originalItems,\n      popoverMaxHeight = _ref2.popoverMaxHeight,\n      _renderItem = _ref2.renderItem,\n      selectedItem = _ref2.selectedItem,\n      title = _ref2.title,\n      width = _ref2.width;\n  itemsFilter = itemsFilter || fuzzyFilter(itemToString);\n  var items = isFilterDisabled || inputValue.trim() === '' ? originalItems : itemsFilter(originalItems, inputValue);\n  if (items.length === 0) return null; // Pass the actual DOM ref to downshift, this fixes touch support\n\n  var menuProps = getMenuProps();\n  return /*#__PURE__*/React.createElement(Pane, _extends({\n    width: width\n  }, menuProps), title && /*#__PURE__*/React.createElement(Pane, {\n    padding: 8,\n    borderBottom: \"muted\"\n  }, /*#__PURE__*/React.createElement(Text, {\n    size: 300,\n    textTransform: \"uppercase\"\n  }, title)), items.length > 0 && /*#__PURE__*/React.createElement(VirtualList, {\n    width: \"100%\",\n    height: Math.min(items.length * itemSize, popoverMaxHeight),\n    itemSize: itemSize,\n    itemCount: items.length,\n    scrollToIndex: highlightedIndex || 0,\n    overscanCount: 3,\n    scrollToAlignment: \"auto\",\n    renderItem: function renderItem(_ref3) {\n      var index = _ref3.index,\n          style = _ref3.style;\n      var item = items[index];\n      var itemString = itemToString(item);\n      return _renderItem(getItemProps({\n        item: item,\n        key: itemString,\n        index: index,\n        style: style,\n        children: itemString,\n        isSelected: itemToString(selectedItem) === itemString,\n        isHighlighted: highlightedIndex === index\n      }));\n    }\n  }));\n};\n\nAutocompleteItems.displayName = \"AutocompleteItems\";\n/* eslint-enable react/prop-types */\n\nvar Autocomplete = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(function Autocomplete(props, ref) {\n  var children = props.children,\n      _props$itemSize = props.itemSize,\n      itemSize = _props$itemSize === void 0 ? 32 : _props$itemSize,\n      position = props.position,\n      _props$renderItem = props.renderItem,\n      renderItem = _props$renderItem === void 0 ? autocompleteItemRenderer : _props$renderItem,\n      _props$isFilterDisabl = props.isFilterDisabled,\n      isFilterDisabled = _props$isFilterDisabl === void 0 ? false : _props$isFilterDisabl,\n      itemsFilter = props.itemsFilter,\n      _props$itemToString = props.itemToString,\n      itemToString = _props$itemToString === void 0 ? function (i) {\n    return i ? String(i) : '';\n  } : _props$itemToString,\n      _props$popoverMaxHeig = props.popoverMaxHeight,\n      popoverMaxHeight = _props$popoverMaxHeig === void 0 ? 240 : _props$popoverMaxHeig,\n      _props$popoverMinWidt = props.popoverMinWidth,\n      popoverMinWidth = _props$popoverMinWidt === void 0 ? 240 : _props$popoverMinWidt,\n      allowOtherValues = props.allowOtherValues,\n      restProps = _objectWithoutProperties(props, [\"children\", \"itemSize\", \"position\", \"renderItem\", \"isFilterDisabled\", \"itemsFilter\", \"itemToString\", \"popoverMaxHeight\", \"popoverMinWidth\", \"allowOtherValues\"]);\n\n  var _useState = useState(0),\n      _useState2 = _slicedToArray(_useState, 2),\n      targetWidth = _useState2[0],\n      setTargetWidth = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      targetRef = _useState4[0],\n      setTargetRef = _useState4[1];\n\n  useEffect(function () {\n    if (targetRef) {\n      setTargetWidth(targetRef.getBoundingClientRect().width);\n    }\n  }, [targetRef]);\n  var stateReducer = useCallback(function (state, changes) {\n    var allowOtherValues = props.allowOtherValues,\n        items = props.items;\n\n    if (Object.prototype.hasOwnProperty.call(changes, 'isOpen') && changes.isOpen) {\n      return _objectSpread(_objectSpread({}, changes), {}, {\n        highlightedIndex: items.indexOf(state.selectedItem)\n      });\n    }\n\n    if (allowOtherValues && state.isOpen && !changes.isOpen) {\n      return _objectSpread(_objectSpread({}, changes), {}, {\n        selectedItem: changes.selectedItem || state.inputValue,\n        inputValue: state.inputValue\n      });\n    }\n\n    return changes;\n  }, [props.items, props.allowOtherValues]);\n  return /*#__PURE__*/React.createElement(Downshift, _extends({\n    stateReducer: stateReducer,\n    scrollIntoView: noop,\n    itemToString: itemToString,\n    ref: ref\n  }, restProps), function (_ref4) {\n    var getItemProps = _ref4.getItemProps,\n        getMenuProps = _ref4.getMenuProps,\n        getRootProps = _ref4.getRootProps,\n        highlightedIndex = _ref4.highlightedIndex,\n        inputValue = _ref4.inputValue,\n        isShown = _ref4.isOpen,\n        selectedItem = _ref4.selectedItem,\n        restDownshiftProps = _objectWithoutProperties(_ref4, [\"getItemProps\", \"getMenuProps\", \"getRootProps\", \"highlightedIndex\", \"inputValue\", \"isOpen\", \"selectedItem\"]);\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        width: '100%'\n      }\n    }, /*#__PURE__*/React.createElement(Popover, {\n      bringFocusInside: false,\n      isShown: isShown,\n      minWidth: popoverMinWidth,\n      position: position || (targetWidth < popoverMinWidth ? Position.BOTTOM_LEFT : Position.BOTTOM),\n      content: function content() {\n        return /*#__PURE__*/React.createElement(AutocompleteItems, {\n          getItemProps: getItemProps,\n          getMenuProps: getMenuProps,\n          highlightedIndex: highlightedIndex,\n          inputValue: inputValue,\n          isFilterDisabled: isFilterDisabled,\n          itemsFilter: itemsFilter,\n          itemSize: itemSize,\n          itemToString: itemToString,\n          originalItems: props.items,\n          popoverMaxHeight: popoverMaxHeight,\n          renderItem: renderItem,\n          selectedItem: selectedItem,\n          title: props.title,\n          width: Math.max(targetWidth, popoverMinWidth)\n        });\n      },\n      minHeight: 0,\n      animationDuration: 0\n    }, function (_ref5) {\n      var _getRef = _ref5.getRef,\n          isShownPopover = _ref5.isShown,\n          toggle = _ref5.toggle;\n      return children(_objectSpread({\n        isShown: isShownPopover,\n        toggle: toggle,\n        getRef: function getRef(ref) {\n          // Use the ref internally to determine the width\n          setTargetRef(ref);\n\n          _getRef(ref);\n        },\n        inputValue: inputValue,\n        selectedItem: selectedItem,\n        highlightedIndex: highlightedIndex\n      }, restDownshiftProps));\n    }));\n  });\n}));\nAutocomplete.propTypes = _objectSpread({\n  /**\n   * This prop can be either a string or a Node.\n   * It will provide a title for the items\n   */\n  title: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n\n  /**\n   * An array of items to be used as options for the select\n   */\n  items: PropTypes.array.isRequired,\n\n  /**\n   * The selected Item to be shown on the autocomplete\n   */\n  selectedItem: PropTypes.any,\n\n  /**\n   * In case the array of items is not an array of strings,\n   * this function is used on each item to return the string that will be shown on the filter\n   */\n  itemToString: PropTypes.func,\n\n  /**\n   * Function that will render the 'filter' component.\n   */\n  children: PropTypes.func.isRequired,\n\n  /**\n   * The height of each item in the list\n   * Because the list is virtualized this is required beforehand.\n   */\n  itemSize: PropTypes.number,\n\n  /**\n   * Function that returns a component to render the item\n   */\n  renderItem: PropTypes.func,\n\n  /**\n   * The position of the Popover the Autocomplete is rendered in.\n   */\n  position: PropTypes.oneOf([Position.TOP, Position.TOP_LEFT, Position.TOP_RIGHT, Position.BOTTOM, Position.BOTTOM_LEFT, Position.BOTTOM_RIGHT, Position.LEFT, Position.RIGHT]),\n\n  /**\n   * A function that is used to filter the items.\n   * It should return a subset of the initial items.\n   * By default the \"fuzzaldrin-plus\" package is used.\n   */\n  itemsFilter: PropTypes.func,\n\n  /**\n   * Prop that enables and disables filtering\n   * True: Enables Filtering\n   * False: Disables Filtering\n   */\n  isFilterDisabled: PropTypes.bool,\n\n  /**\n   * Defines the minimum height the results container will be\n   */\n  popoverMinWidth: PropTypes.number,\n\n  /**\n   * Defines the maximum height the results container will be\n   */\n  popoverMaxHeight: PropTypes.number,\n\n  /**\n   * Whether or not the input accepts arbitrary user input beyond the provided items\n   */\n  allowOtherValues: PropTypes.bool\n}, Downshift.propTypes);\nexport default Autocomplete;","map":{"version":3,"sources":["../../../src/autocomplete/src/Autocomplete.js"],"names":["fuzzyFilter","wrappedItems","key","itemToString","item","fuzzaldrin","noop","autocompleteItemRenderer","AutocompleteItems","getItemProps","getMenuProps","highlightedIndex","inputValue","isFilterDisabled","itemSize","itemsFilter","originalItems","popoverMaxHeight","renderItem","selectedItem","title","width","items","menuProps","Math","index","style","itemString","children","isSelected","isHighlighted","Autocomplete","memo","forwardRef","position","i","String","popoverMinWidth","allowOtherValues","restProps","props","targetWidth","setTargetWidth","useState","targetRef","setTargetRef","useEffect","stateReducer","useCallback","Object","changes","state","ref","getRootProps","isShown","restDownshiftProps","Position","getRef","isShownPopover","toggle","PropTypes","bool","Downshift"],"mappings":"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","sourcesContent":["import React, { memo, forwardRef, useState, useEffect, useCallback } from 'react'\nimport Downshift from 'downshift'\nimport fuzzaldrin from 'fuzzaldrin-plus'\nimport PropTypes from 'prop-types'\nimport VirtualList from 'react-tiny-virtual-list'\nimport { Position } from '../../constants'\nimport { Pane } from '../../layers'\nimport { Popover } from '../../popover'\nimport { Text } from '../../typography'\nimport AutocompleteItem from './AutocompleteItem'\n\nconst fuzzyFilter = itemToString => {\n  if (itemToString) {\n    return (items, input) => {\n      const wrappedItems = items.map(item => ({\n        key: itemToString(item),\n        item\n      }))\n\n      return fuzzaldrin.filter(wrappedItems, input, { key: 'key' }).map(({ item }) => item)\n    }\n  }\n\n  return (items, input) => fuzzaldrin.filter(items, input)\n}\n\nconst noop = () => {}\n\nconst autocompleteItemRenderer = props => <AutocompleteItem {...props} />\n\n/* eslint-disable react/prop-types */\nconst AutocompleteItems = ({\n  getItemProps,\n  getMenuProps,\n  highlightedIndex,\n  inputValue,\n  isFilterDisabled,\n  itemSize,\n  itemToString,\n  itemsFilter,\n  originalItems,\n  popoverMaxHeight,\n  renderItem,\n  selectedItem,\n  title,\n  width\n}) => {\n  itemsFilter = itemsFilter || fuzzyFilter(itemToString)\n  const items = isFilterDisabled || inputValue.trim() === '' ? originalItems : itemsFilter(originalItems, inputValue)\n\n  if (items.length === 0) return null\n\n  // Pass the actual DOM ref to downshift, this fixes touch support\n  const menuProps = getMenuProps()\n\n  return (\n    <Pane width={width} {...menuProps}>\n      {title && (\n        <Pane padding={8} borderBottom=\"muted\">\n          <Text size={300} textTransform=\"uppercase\">\n            {title}\n          </Text>\n        </Pane>\n      )}\n      {items.length > 0 && (\n        <VirtualList\n          width=\"100%\"\n          height={Math.min(items.length * itemSize, popoverMaxHeight)}\n          itemSize={itemSize}\n          itemCount={items.length}\n          scrollToIndex={highlightedIndex || 0}\n          overscanCount={3}\n          scrollToAlignment=\"auto\"\n          renderItem={({ index, style }) => {\n            const item = items[index]\n            const itemString = itemToString(item)\n\n            return renderItem(\n              getItemProps({\n                item,\n                key: itemString,\n                index,\n                style,\n                children: itemString,\n                isSelected: itemToString(selectedItem) === itemString,\n                isHighlighted: highlightedIndex === index\n              })\n            )\n          }}\n        />\n      )}\n    </Pane>\n  )\n}\n/* eslint-enable react/prop-types */\n\nconst Autocomplete = memo(\n  forwardRef(function Autocomplete(props, ref) {\n    const {\n      children,\n      itemSize = 32,\n      position,\n      renderItem = autocompleteItemRenderer,\n      isFilterDisabled = false,\n      itemsFilter,\n      itemToString = i => (i ? String(i) : ''),\n      popoverMaxHeight = 240,\n      popoverMinWidth = 240,\n      allowOtherValues,\n      ...restProps\n    } = props\n\n    const [targetWidth, setTargetWidth] = useState(0)\n    const [targetRef, setTargetRef] = useState()\n\n    useEffect(() => {\n      if (targetRef) {\n        setTargetWidth(targetRef.getBoundingClientRect().width)\n      }\n    }, [targetRef])\n\n    const stateReducer = useCallback(\n      (state, changes) => {\n        const { allowOtherValues, items } = props\n\n        if (Object.prototype.hasOwnProperty.call(changes, 'isOpen') && changes.isOpen) {\n          return {\n            ...changes,\n            highlightedIndex: items.indexOf(state.selectedItem)\n          }\n        }\n\n        if (allowOtherValues && state.isOpen && !changes.isOpen) {\n          return {\n            ...changes,\n            selectedItem: changes.selectedItem || state.inputValue,\n            inputValue: state.inputValue\n          }\n        }\n\n        return changes\n      },\n      [props.items, props.allowOtherValues]\n    )\n\n    return (\n      <Downshift stateReducer={stateReducer} scrollIntoView={noop} itemToString={itemToString} ref={ref} {...restProps}>\n        {({\n          getItemProps,\n          getMenuProps,\n          getRootProps,\n          highlightedIndex,\n          inputValue,\n          isOpen: isShown,\n          selectedItem,\n          ...restDownshiftProps\n        }) => (\n          <div style={{ width: '100%' }}>\n            <Popover\n              bringFocusInside={false}\n              isShown={isShown}\n              minWidth={popoverMinWidth}\n              position={position || (targetWidth < popoverMinWidth ? Position.BOTTOM_LEFT : Position.BOTTOM)}\n              content={() => (\n                <AutocompleteItems\n                  getItemProps={getItemProps}\n                  getMenuProps={getMenuProps}\n                  highlightedIndex={highlightedIndex}\n                  inputValue={inputValue}\n                  isFilterDisabled={isFilterDisabled}\n                  itemsFilter={itemsFilter}\n                  itemSize={itemSize}\n                  itemToString={itemToString}\n                  originalItems={props.items}\n                  popoverMaxHeight={popoverMaxHeight}\n                  renderItem={renderItem}\n                  selectedItem={selectedItem}\n                  title={props.title}\n                  width={Math.max(targetWidth, popoverMinWidth)}\n                />\n              )}\n              minHeight={0}\n              animationDuration={0}\n            >\n              {({ getRef, isShown: isShownPopover, toggle }) =>\n                children({\n                  isShown: isShownPopover,\n                  toggle,\n                  getRef: ref => {\n                    // Use the ref internally to determine the width\n                    setTargetRef(ref)\n                    getRef(ref)\n                  },\n                  inputValue,\n                  selectedItem,\n                  highlightedIndex,\n                  ...restDownshiftProps\n                })\n              }\n            </Popover>\n          </div>\n        )}\n      </Downshift>\n    )\n  })\n)\n\nAutocomplete.propTypes = {\n  /**\n   * This prop can be either a string or a Node.\n   * It will provide a title for the items\n   */\n  title: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n\n  /**\n   * An array of items to be used as options for the select\n   */\n  items: PropTypes.array.isRequired,\n\n  /**\n   * The selected Item to be shown on the autocomplete\n   */\n  selectedItem: PropTypes.any,\n\n  /**\n   * In case the array of items is not an array of strings,\n   * this function is used on each item to return the string that will be shown on the filter\n   */\n  itemToString: PropTypes.func,\n\n  /**\n   * Function that will render the 'filter' component.\n   */\n  children: PropTypes.func.isRequired,\n\n  /**\n   * The height of each item in the list\n   * Because the list is virtualized this is required beforehand.\n   */\n  itemSize: PropTypes.number,\n\n  /**\n   * Function that returns a component to render the item\n   */\n  renderItem: PropTypes.func,\n\n  /**\n   * The position of the Popover the Autocomplete is rendered in.\n   */\n  position: PropTypes.oneOf([\n    Position.TOP,\n    Position.TOP_LEFT,\n    Position.TOP_RIGHT,\n    Position.BOTTOM,\n    Position.BOTTOM_LEFT,\n    Position.BOTTOM_RIGHT,\n    Position.LEFT,\n    Position.RIGHT\n  ]),\n\n  /**\n   * A function that is used to filter the items.\n   * It should return a subset of the initial items.\n   * By default the \"fuzzaldrin-plus\" package is used.\n   */\n  itemsFilter: PropTypes.func,\n\n  /**\n   * Prop that enables and disables filtering\n   * True: Enables Filtering\n   * False: Disables Filtering\n   */\n  isFilterDisabled: PropTypes.bool,\n\n  /**\n   * Defines the minimum height the results container will be\n   */\n  popoverMinWidth: PropTypes.number,\n\n  /**\n   * Defines the maximum height the results container will be\n   */\n  popoverMaxHeight: PropTypes.number,\n\n  /**\n   * Whether or not the input accepts arbitrary user input beyond the provided items\n   */\n  allowOtherValues: PropTypes.bool,\n\n  ...Downshift.propTypes\n}\n\nexport default Autocomplete\n"]},"metadata":{},"sourceType":"module"}